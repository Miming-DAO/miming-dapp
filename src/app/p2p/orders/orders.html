<div class="max-w-7xl mx-auto">
  <div class="backdrop-blur-xl bg-slate-800/50 rounded-3xl border border-purple-500/20 p-4 md:p-8">

    <!-- Panel Header -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
      <div>
        <h2 class="text-xl md:text-2xl font-bold text-white mb-1 md:mb-2">Order History</h2>
        <p class="text-sm md:text-base text-slate-400">Track your P2P transactions</p>
      </div>

      <!-- View Toggle (My Orders vs My Ad Orders) -->
      <div class="flex gap-2">
        <button (click)="activeViewTab = 'my-orders'"
          [class]="activeViewTab === 'my-orders' ? 'bg-linear-to-r from-purple-600 to-pink-600 text-white shadow-lg' : 'bg-slate-800/50 text-slate-300 hover:bg-slate-700/50'"
          class="flex-1 sm:flex-none px-4 md:px-6 py-2.5 md:py-3 rounded-3xl font-bold text-sm md:text-base transition-all duration-200 cursor-pointer flex items-center justify-center gap-2">
          <i class="pi pi-shopping-bag"></i>
          <span class="hidden sm:inline">My Orders</span>
          <span class="sm:hidden">Mine</span>
        </button>

        <button (click)="activeViewTab = 'ad-orders'"
          [class]="activeViewTab === 'ad-orders' ? 'bg-linear-to-r from-purple-600 to-pink-600 text-white shadow-lg' : 'bg-slate-800/50 text-slate-300 hover:bg-slate-700/50'"
          class="flex-1 sm:flex-none px-4 md:px-6 py-2.5 md:py-3 rounded-3xl font-bold text-sm md:text-base transition-all duration-200 cursor-pointer flex items-center justify-center gap-2">
          <i class="pi pi-briefcase"></i>
          <span class="hidden sm:inline">Ad Orders</span>
          <span class="sm:hidden">Ads</span>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-col md:flex-row gap-3 mb-6">
      <div class="w-full md:w-56">
        <p-select [options]="statusOptions" [(ngModel)]="activeStatusTab" placeholder="Filter by Status"
          optionLabel="label" optionValue="value" class="w-full" size="large">
          <ng-template #selectedItem let-selectedOption>
            @if (selectedOption) {
            <div class="flex items-center gap-2">
              <i [class]="selectedOption.icon" class="text-sm"></i>
              <span class="font-medium">{{ selectedOption.label }}</span>
            </div>
            }
          </ng-template>
          <ng-template let-status #item>
            <div class="flex items-center gap-2 py-1">
              <i [class]="status.icon" class="text-sm"></i>
              <span class="font-medium">{{ status.label }}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="flex-1">
        <input type="text" [(ngModel)]="searchTerm" placeholder="Search by order number, user, or amount..."
          class="w-full px-4 py-3 rounded-3xl bg-slate-800/50 border border-gray-100/30 text-white placeholder:text-slate-500 outline-none focus:border-purple-500/50 transition-all" />
      </div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
    <div class="flex justify-center items-center py-12">
      <div class="flex flex-col items-center gap-4">
        <i class="pi pi-spin pi-spinner text-4xl text-purple-400"></i>
        <p class="text-slate-400">Loading orders...</p>
      </div>
    </div>
    }

    <!-- Empty State -->
    @if (!isLoading && filteredOrders.length === 0) {
    <div class="text-center py-12">
      <div class="w-20 h-20 mx-auto mb-4 rounded-3xl bg-purple-500/10 flex items-center justify-center">
        <i [class]="activeViewTab === 'my-orders' ? 'pi pi-shopping-bag' : 'pi pi-briefcase'"
          class="text-4xl text-purple-400"></i>
      </div>
      <h3 class="text-xl font-semibold text-white mb-2">No {{ activeStatusTab === 'in-progress' ? 'In Progress' :
        activeStatusTab }} Orders</h3>
      <p class="text-slate-400 mb-6">
        @if (activeViewTab === 'my-orders') {
        You don't have any {{ activeStatusTab === 'in-progress' ? 'in progress' : activeStatusTab }} orders at the
        moment
        } @else {
        No one has placed {{ activeStatusTab === 'in-progress' ? 'in progress' : activeStatusTab }} orders on your ads
        yet
        }
      </p>
      <button (click)="loadOrders()"
        class="px-6 py-3 rounded-3xl bg-linear-to-r from-purple-600 to-pink-600 text-white font-bold hover:scale-105 transition-all duration-200 shadow-sm cursor-pointer">
        <i class="pi pi-refresh mr-2"></i>
        Refresh
      </button>
    </div>
    }

    <!-- Order List -->
    @if (!isLoading && filteredOrders.length > 0) {

    <!-- Desktop Table View -->
    <div
      class="hidden md:block backdrop-blur-xl bg-slate-800/50 rounded-3xl border border-purple-500/20 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full min-w-max">
          <thead>
            <tr class="border-b border-slate-700">
              <th class="text-left py-3 px-4 text-sm font-semibold text-slate-400">Order</th>
              <th class="text-left py-3 px-4 text-sm font-semibold text-slate-400 hidden lg:table-cell">Date</th>
              <th class="text-right py-3 px-4 text-sm font-semibold text-slate-400">Price</th>
              <th class="text-right py-3 px-4 text-sm font-semibold text-slate-400 hidden xl:table-cell">Quantity</th>
              <th class="text-right py-3 px-4 text-sm font-semibold text-slate-400">Amount</th>
              <th class="text-left py-3 px-4 text-sm font-semibold text-slate-400 hidden lg:table-cell">Payment</th>
              <th class="text-left py-3 px-4 text-sm font-semibold text-slate-400">Status</th>
              <th class="text-center py-3 px-4 text-sm font-semibold text-slate-400">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (order of filteredOrders; track order.id) {
            <tr class="border-b border-slate-700/50 hover:bg-slate-700/30 transition-colors">

              <!-- Order Number + Type Chip -->
              <td class="py-4 px-4">
                <div class="flex items-center gap-3">
                  <div class="min-w-0">
                    <div class="font-semibold text-white truncate mb-2">{{ order.order_number }}</div>
                    <span
                      [class]="order.order_type === 'buy' ? 'bg-green-600 text-white border-green-500' : 'bg-pink-600 text-white border-pink-500'"
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold border uppercase"
                      [attr.aria-label]="order.order_type === 'buy' ? 'Buy order' : 'Sell order'">
                      <i [class]="order.order_type === 'buy' ? 'pi pi-arrow-down' : 'pi pi-arrow-up'"
                        class="mr-1.5"></i>
                      {{ order.order_type === 'buy' ? 'Buy' : 'Sell' }}
                    </span>
                  </div>
                </div>
              </td>

              <!-- Date Column -->
              <td class="py-4 px-4 hidden lg:table-cell">
                <div class="text-sm text-slate-300">{{ order.created_at | date:'MMM d, y' }}</div>
                <div class="text-xs text-slate-400 mt-1">{{ order.created_at | date:'h:mm a' }}</div>
              </td>

              <!-- Price Column -->
              <td class="py-4 px-4 text-right">
                <div class="font-bold text-base text-slate-200 whitespace-nowrap">
                  ₱{{ order.ordered_price | number:'1.2-2' }}
                </div>
                <div class="text-xs text-slate-400 mt-0.5">per unit</div>
              </td>

              <!-- Quantity Column -->
              <td class="py-4 px-4 text-right hidden xl:table-cell">
                <div class="font-semibold text-white">{{ order.quantity | number:'1.2-6' }}</div>
                <div class="text-xs text-slate-400">USDT</div>
              </td>

              <!-- Amount Column -->
              <td class="py-4 px-4 text-right">
                <div
                  class="font-bold text-lg bg-linear-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent whitespace-nowrap">
                  ₱{{ order.amount | number:'1.2-2' }}
                </div>
              </td>

              <!-- Payment Method -->
              <td class="py-4 px-4 hidden lg:table-cell">
                <div class="flex items-center gap-2">
                  @if (order.p2p_payment_type?.logo_url) {
                  <img [src]="order.p2p_payment_type!.logo_url" [alt]="order.p2p_payment_type!.name"
                    class="w-5 h-5 object-contain" />
                  } @else {
                  <div class="w-5 h-5 rounded-full bg-purple-500/20 flex items-center justify-center">
                    <i class="pi pi-wallet text-purple-400 text-xs"></i>
                  </div>
                  }
                  <span class="text-sm text-slate-300">{{ order.p2p_payment_type?.name || 'N/A' }}</span>
                </div>
              </td>

              <!-- Status -->
              <td class="py-4 px-4">
                <span [class]="getStatusBadgeClass(order.status)"
                  class="px-2 py-1 rounded-full text-xs font-semibold border uppercase inline-block">
                  {{ order.status }}
                </span>
              </td>

              <!-- Actions -->
              <td class="py-4 px-4">
                <div class="flex items-center justify-center">
                  <button (click)="openOrderDetails(order)" title="View Details"
                    class="w-8 h-8 flex items-center justify-center rounded-full bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 transition-all cursor-pointer">
                    <i class="pi pi-eye text-sm"></i>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Mobile Card View -->
    <div class="md:hidden space-y-3">
      @for (order of filteredOrders; track order.id) {
      <div
        class="backdrop-blur-xl bg-linear-to-br from-slate-800/80 via-purple-900/30 to-slate-800/90 rounded-3xl border border-purple-500/20 p-4 hover:border-purple-500/40 transition-all duration-200"
        (click)="openOrderDetails(order)">

        <!-- Header: Type Badge + Status -->
        <div class="flex items-center justify-between mb-3">
          <span
            [class]="order.order_type === 'buy' ? 'bg-green-600 text-white border-green-500' : 'bg-pink-600 text-white border-pink-500'"
            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold border uppercase"
            [attr.aria-label]="order.order_type === 'buy' ? 'Buy order' : 'Sell order'">
            <i [class]="order.order_type === 'buy' ? 'pi pi-arrow-down' : 'pi pi-arrow-up'" class="mr-1.5"></i>
            {{ order.order_type === 'buy' ? 'Buy' : 'Sell' }}
          </span>
          <span [class]="getStatusBadgeClass(order.status)"
            class="px-2 py-1 rounded-full text-xs font-semibold border uppercase">
            {{ order.status }}
          </span>
        </div>

        <!-- Order Number + Date -->
        <div class="flex items-center gap-3 mb-3 px-2">
          <div class="flex-1 min-w-0">
            <h3 class="font-bold text-white truncate">{{ order.order_number }}</h3>
            <p class="text-xs text-slate-400">{{ order.created_at | date:'MMM d, y h:mm a' }}</p>
          </div>
        </div>

        <!-- Price & Amount -->
        <div class="border-b border-slate-700/50 mb-3 pb-3">
          <div class="flex items-center justify-between px-2 mb-2">
            <span class="text-xs text-slate-400">Unit Price</span>
            <div class="font-bold text-base text-slate-200">
              ₱{{ order.ordered_price | number:'1.2-2' }}
            </div>
          </div>
          <div class="flex items-center justify-between px-2">
            <span class="text-xs text-slate-400">Total Amount</span>
            <div class="font-bold text-xl bg-linear-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent">
              ₱{{ order.amount | number:'1.2-2' }}
            </div>
          </div>
        </div>

        <!-- Info Grid -->
        <div class="space-y-2 mb-3">
          <div class="flex justify-between px-2">
            <span class="text-xs text-slate-400">Quantity</span>
            <div class="text-white font-bold text-sm text-right">{{ order.quantity | number:'1.2-6' }} USDT</div>
          </div>
          <div class="flex justify-between px-2">
            <span class="text-xs text-slate-400">Payment Method</span>
            <div class="flex items-center gap-1.5">
              @if (order.p2p_payment_type?.logo_url) {
              <img [src]="order.p2p_payment_type!.logo_url" [alt]="order.p2p_payment_type!.name"
                class="w-4 h-4 object-contain" />
              }
              <span class="text-white font-bold text-sm">{{ order.p2p_payment_type?.name || 'N/A' }}</span>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    }
  </div>
</div>

<!-- Toast -->
<p-toast />
